

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Defining Observables &mdash; EOS 1.0.8 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/contentui.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  
    <link rel="canonical" href="https://eos.github.io/doc/defining-observables.html" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/contentui.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analysis Organisation" href="analysis-organisation.html" />
    <link rel="prev" title="Advanced Usage" href="advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EOS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="use-cases.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="advanced.html">Advanced Usage</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining Observables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#syntax">Syntax</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#arithmetic-expressions">Arithmetic Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dealing-with-kinematic-variables">Dealing with Kinematic Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#making-a-new-observable-known">Making a new Observable known</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis-organisation.html">Analysis Organisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">Common Tasks in Phenomenological Analyses</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-line-interface.html">The EOS Command-Line Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/python.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="constraints.html">List of Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="observables.html">List of Observables</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">List of Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">List of References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EOS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="advanced.html">Advanced Usage</a> &raquo;</li>
        
      <li>Defining Observables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="defining-observables">
<h1>Defining Observables<a class="headerlink" href="#defining-observables" title="Permalink to this heading">¶</a></h1>
<p id="id1">A user can define new observables for their analyses by combining existing observables, parameters, and kinematic variables within an arithmetic expression.
Observables defined in this way benefit from the same optimizations as all built-in observables, including multi-threaded evaluation and caching.
This section describes and exemplifies the syntax of the expression parser that interprets user defined python strings as new EOS observables.</p>
<section id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading">¶</a></h2>
<section id="arithmetic-expressions">
<h3>Arithmetic Expressions<a class="headerlink" href="#arithmetic-expressions" title="Permalink to this heading">¶</a></h3>
<p>Basic rules are used to parse the input string</p>
<blockquote>
<div><ul>
<li><p>Whitespaces such as spaces and tabs do not have semantic meaning and are ignored when parsing the expression.
Hence, they can be added arbitrarily for readability.</p></li>
<li><p>Expressions are built upon the arithmetic operations</p>
<blockquote>
<div><ul class="simple">
<li><p>addition <code class="docutils literal notranslate"><span class="pre">+</span></code>,</p></li>
<li><p>subtraction <code class="docutils literal notranslate"><span class="pre">-</span></code>,</p></li>
<li><p>multiplication <code class="docutils literal notranslate"><span class="pre">*</span></code>,</p></li>
<li><p>division <code class="docutils literal notranslate"><span class="pre">/</span></code>,</p></li>
<li><p>and exponentiation <code class="docutils literal notranslate"><span class="pre">^</span></code>.</p></li>
</ul>
</div></blockquote>
<p>Parentheses are recognized in expressions, and the usual precedence rules of arithmetics apply.</p>
</li>
<li><p>Expression typically reference one or more EOS objects (either observables or a parameters) by name, it must be encapsulated by two chevrons: <code class="docutils literal notranslate"><span class="pre">&lt;&lt;...&gt;&gt;</span></code>.
Names must be fulfill the requirements of <code class="code docutils literal notranslate"><span class="pre">eos.QualifiedName</span></code>. All features of a qualified name are supported,
including specifying option.
Names are assumed to point to an observable by default. If no observable of that name exists, a parameter of the same name is used.
If neither an observable nor a parameter of that name exists, an exception is raised.
Examples for a reference include <code class="docutils literal notranslate"><span class="pre">&lt;&lt;mass::mu&gt;&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;&lt;B_u-&gt;lnu::BR&gt;&gt;</span></code>.</p></li>
<li><p>Expressions can reference a kinematic variable. Its name must be encapsulated by curly braces: <code class="docutils literal notranslate"><span class="pre">{...}</span></code>.
The kinematic variable can already be used by an observable within the expression. If no observable uses the kinematic variable,
a new kinematic variable is automatically created. Examples for a kinematic variable include <code class="docutils literal notranslate"><span class="pre">{q2}</span></code> or <code class="docutils literal notranslate"><span class="pre">{E_gamma}</span></code>.</p></li>
</ul>
</div></blockquote>
<p>The following strings are valid observable expressions</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(&lt;&lt;mass::B_d&gt;&gt;^2</span> <span class="pre">-</span> <span class="pre">4</span> <span class="pre">*</span> <span class="pre">&lt;&lt;mass::mu&gt;&gt;^2)</span> <span class="pre">^</span> <span class="pre">0.5</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1.0</span> <span class="pre">/</span> <span class="pre">&lt;&lt;B_u-&gt;lnu::BR;l=mu&gt;&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;B-&gt;K::f_+(q2)&gt;&gt;</span> <span class="pre">*</span> <span class="pre">(1</span> <span class="pre">-</span> <span class="pre">{q2}</span> <span class="pre">/</span> <span class="pre">&lt;&lt;mass::B_d^*&gt;&gt;^2)</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="dealing-with-kinematic-variables">
<h3>Dealing with Kinematic Variables<a class="headerlink" href="#dealing-with-kinematic-variables" title="Permalink to this heading">¶</a></h3>
<p>By default, a referenced observable’s dependence on a kinematic variables is transferred to the newly defined observable.
For example, the observable defined by the expression <code class="docutils literal notranslate"><span class="pre">1.0</span> <span class="pre">/</span> <span class="pre">&lt;&lt;B-&gt;pilnu::dBR/dq2&gt;&gt;</span></code> depends on the kinematic variable
<code class="docutils literal notranslate"><span class="pre">q2</span></code>, since the reference observable <code class="docutils literal notranslate"><span class="pre">B-&gt;pilnu::dBR/dq2</span></code> does.
When more than one observable appears in the expression, it is sometimes useful or even essential to rename kinematic variables,
i.e., create an alias for the name of the kinematic variable.
For example, wenn defining a lepton-flavour universality observable such as the ratio of branching fractions <code class="docutils literal notranslate"><span class="pre">&lt;&lt;B-&gt;Dlnu::BR;l=tau&gt;&gt;</span> <span class="pre">/</span> <span class="pre">&lt;&lt;B-&gt;Dlnu::BR;l=mu&gt;&gt;</span></code>,
the kinematic variable <code class="docutils literal notranslate"><span class="pre">q2</span></code> should be renamed t     rather than two kinematic variables.</p>
<blockquote>
<div><blockquote>
<div><p>two only expects a specification for <code class="docutils literal notranslate"><span class="pre">q2_max</span></code>.evaluation of the denominator.</p>
</div></blockquote>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">=</span></code> operator fixes a kinematic variable to a given value.
For example, the expression <code class="docutils literal notranslate"><span class="pre">&lt;&lt;B-&gt;pilnu::BR&gt;&gt;[q2_min=0.1]</span></code> expects only one kinematic variable <code class="docutils literal notranslate"><span class="pre">q2_max</span></code>.
The kinematic variable <code class="docutils literal notranslate"><span class="pre">q2_min</span></code> that the references observable <code class="docutils literal notranslate"><span class="pre">B-&gt;pilnu::BR</span></code> also depends on is
fixed to the value <code class="docutils literal notranslate"><span class="pre">0.1</span></code>.</p></li>
</ul>
</div></blockquote>
<p>Note that both types of specifications can be combined in comma-separated list in an arbitrary order, for example <code class="docutils literal notranslate"><span class="pre">[q2_min=1.0,q2_max=&gt;q2_max_mu]</span></code>.</p>
</section>
</section>
<section id="making-a-new-observable-known">
<h2>Making a new Observable known<a class="headerlink" href="#making-a-new-observable-known" title="Permalink to this heading">¶</a></h2>
<p>To make a new observable known to EOS, it must be added to the list of observables.
This can be done using the <a href="#id2"><span class="problematic" id="id3">:method:`eos.Observables.insert`</span></a> method.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eos</span><span class="o">.</span><span class="n">Observables</span><span class="p">()</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">latex</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the arguments <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">latex</span></code> and <code class="docutils literal notranslate"><span class="pre">unit</span></code> are the qualified name, the latex representation, and the unit of the new observable, respectively.
Known units include:</p>
<p>The argument <code class="docutils literal notranslate"><span class="pre">options</span></code> takes an <a class="reference internal" href="api/python.html#eos.Options" title="eos.Options"><code class="xref py py-class docutils literal notranslate"><span class="pre">eos.Options</span></code></a> object and allows to specify <em>global</em> options (i.e. applied to all observables in the expression),
for the newly defined observable.
The argument <code class="docutils literal notranslate"><span class="pre">expression</span></code> is Python string that is parsed as described above.</p>
<p>We conclude with a concrete example for the definition of the lepton-flavour universality observable <span class="math notranslate nohighlight">\(R_K\)</span>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eos</span><span class="o">.</span><span class="n">Observables</span><span class="p">()</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;B-&gt;Kll::R_K_example&#39;</span><span class="p">,</span> <span class="sa">R</span><span class="s1">&#39;(R_K)&#39;</span><span class="p">,</span> <span class="n">eos</span><span class="o">.</span><span class="n">Unit</span><span class="o">.</span><span class="n">Unity</span><span class="p">(),</span> <span class="n">eos</span><span class="o">.</span><span class="n">Options</span><span class="p">(),</span>
                         <span class="s1">&#39;( &lt;&lt;B-&gt;Kll::BR;l=mu&gt;&gt;[q2_max=6, q2_min=&gt;q2_mu_min] / &lt;&lt;B-&gt;Kll::BR;l=e&gt;&gt;[q2_max=6,q2_min=&gt;q2_e_min] )&#39;</span><span class="p">)</span>

<span class="n">R_K</span> <span class="o">=</span> <span class="n">eos</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;B-&gt;Kll::R_K_example&#39;</span><span class="p">,</span> <span class="n">eos</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Defaults</span><span class="p">(),</span> <span class="n">eos</span><span class="o">.</span><span class="n">Kinematics</span><span class="p">(</span><span class="n">q2_e_min</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">q2_mu_min</span><span class="o">=</span><span class="mf">1.1</span><span class="p">),</span> <span class="n">eos</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;tag&#39;</span><span class="p">:</span><span class="s1">&#39;BFS2004&#39;</span><span class="p">}))</span>

<span class="n">R_K</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>   <span class="c1"># should yield ~1</span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="analysis-organisation.html" class="btn btn-neutral float-right" title="Analysis Organisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="advanced.html" class="btn btn-neutral float-left" title="Advanced Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2023, The EOS Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>